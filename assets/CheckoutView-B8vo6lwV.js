import{_ as k,m as g,S as i,l as D,a as T,r as b,o as _,c as f,b as e,F as j,g as S,t as r,h as B,d as n,e as w,f as E,j as h,q as N,v as P,i as m}from"./index-_rV0SiY7.js";import{c as y}from"./cartStore-rhnC-t0x.js";import{u as I}from"./utilStore-HsoZxjLk.js";var M={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"popovgo",VITE_POKEMON_API:"https://pokeapi.co/api/v2",BASE_URL:"/PokemonMachineShop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:O,VITE_PATH:U}=M,L={data(){return{orderData:{data:{user:{name:"",email:"",tel:"",address:""},message:""}}}},mounted(){this.getCart()},methods:{...g(y,["getCart"]),...g(I,["copyTextToClipboard"]),isPhone(o){return/^(09)[0-9]{8}$/.test(o)?!0:"需要正確的電話號碼"},postOrder(){const o={...this.orderData},s=i.mixin({customClass:{confirmButton:"btn btn-primary",cancelButton:"btn btn-outline-danger me-4"},buttonsStyling:!1});s.fire({title:"請確認以下資訊",html:`
          Email：${o.data.user.email}<br>
          姓名：${o.data.user.name}<br>
          電話：${o.data.user.tel}<br>
          地址：${o.data.user.address}<br>
          點擊送出後將完成交易
        `,icon:"warning",showCancelButton:!0,confirmButtonText:"完成交易",cancelButtonText:"回到結帳頁面",reverseButtons:!0}).then(v=>{v.isConfirmed?D.post(`${O}/api/${U}/order`,o).then(d=>{this.copyTextToClipboard(d.data.orderId);let a;i.fire({icon:"success",title:`${d.data.message}
訂單編號：${d.data.orderId}
自動複製到剪貼簿`,html:"<b></b>秒後回到產品列表",timer:3e3,timerProgressBar:!0,didOpen:()=>{i.showLoading();const c=i.getPopup().querySelector("b");a=setInterval(()=>{c.textContent=`${Math.ceil(i.getTimerLeft()/1e3)}`},100)},willClose:()=>{clearInterval(a)}}).then(c=>{c.dismiss,i.DismissReason.timer}).then(()=>{this.$router.push("/products")})}).catch(d=>{console.dir(d),i.fire({position:"top-end",icon:"error",title:"送出訂單失敗，請聯繫管理員",showConfirmButton:!1,timer:1e3})}):v.dismiss===i.DismissReason.cancel&&s.fire({title:"訂單資料未送出",icon:"warning"})})}},computed:{...T(y,["carts"])},watch:{}},R={class:"container mt-md-5 mt-3 mb-7"},q=E('<div class="row justify-content-center"><div class="col-md-10"><nav class="navbar navbar-expand-lg navbar-light px-0"><ul class="list-unstyled mb-0 ms-md-auto d-flex align-items-center justify-content-between justify-content-md-end w-100 mt-md-0 mt-4"><li class="me-md-6 me-3 position-relative custom-step-line"><i class="bi bi-check-circle d-md-inline d-block text-center"></i> <span class="text-nowrap">瀏覽產品</span></li><li class="me-md-6 me-3 position-relative custom-step-line"><i class="bi bi-check-circle d-md-inline d-block text-center"></i> <span class="text-nowrap">加入購物車</span></li><li><i class="bi bi-dot d-md-inline d-block text-center"></i> <span class="text-nowrap">送出訂單</span></li></ul></nav></div></div><div class="row justify-content-center"><div class="col-md-10"><h3 class="fw-bold mb-4 pt-3">填寫資料</h3></div></div>',2),A={class:"row flex-row-reverse justify-content-center pb-5"},$={class:"col-md-4"},H={class:"border p-4 mb-4"},F=["src"],z={class:"w-100"},K={class:"d-flex justify-content-between"},W={class:"mb-0 fw-bold"},G={class:"mb-0"},J={class:"mb-0 fw-bold"},Q={key:0,class:"d-flex justify-content-between mt-4"},X=e("p",{class:"mb-0 h4 fw-bold"},"優惠折扣",-1),Y={class:"mb-0 h4 fw-bold"},Z={class:"d-flex justify-content-between mt-4"},ee=e("p",{class:"mb-0 h4 fw-bold"},"總額",-1),te={class:"mb-0 h4 fw-bold"},se={class:"col-md-6"},ae=e("h4",null,"聯絡資訊",-1),oe={class:"mb-0"},le=e("label",{for:"ContactMail",class:"text-muted mb-0 form-label"},[e("span",{class:"text-danger"},"*"),m("Email")],-1),ne=e("h4",{class:"mt-4"},"送件資訊",-1),ie={class:"mb-2"},re=e("label",{for:"ContactName",class:"text-muted mb-0"},[e("span",{class:"text-danger"},"*"),m("姓名")],-1),de={class:"mb-2"},ce=e("label",{for:"ContactPhone",class:"text-muted mb-0"},[e("span",{class:"text-danger"},"*"),m("電話")],-1),me={class:"mb-3"},ue=e("label",{for:"address",class:"form-label"},[e("span",{class:"text-danger"},"*"),m("收件人地址")],-1),pe={class:"mb-2"},be=e("label",{for:"ContactMessage",class:"text-muted mb-0"},"備註",-1),_e={class:"d-flex flex-column-reverse flex-md-row mt-4 justify-content-between align-items-md-center align-items-end w-100"},fe=e("i",{class:"fas fa-chevron-left me-2"},null,-1),he=["disabled"];function ve(o,s,v,d,a,c){var x;const u=b("v-field"),p=b("error-message"),V=b("router-link"),C=b("v-form");return _(),f("div",R,[q,e("div",A,[e("div",$,[e("div",H,[(_(!0),f(j,null,S(o.carts.carts,l=>{var t;return _(),f("div",{class:"d-flex",key:l.id},[e("img",{src:l.product.imageUrl,alt:"",class:"me-2",style:{width:"48px",height:"48px","object-fit":"cover"}},null,8,F),e("div",z,[e("div",K,[e("p",W,r(l.product.title)+" "+r(l.product.unit),1),e("p",G,"NT$"+r((t=l.total)==null?void 0:t.toLocaleString()),1)]),e("p",J,"x"+r(l.qty),1)])])}),128)),o.carts.final_total!=o.carts.total?(_(),f("div",Q,[X,e("p",Y,r(Math.floor(o.carts.final_total/o.carts.total*100))+" %",1)])):B("",!0),e("div",Z,[ee,e("p",te,"NT$"+r((x=Math.floor(o.carts.final_total))==null?void 0:x.toLocaleString()),1)])])]),e("div",se,[n(C,null,{default:w(({errors:l})=>[ae,e("div",oe,[le,n(u,{type:"email",class:h(["form-control",{"is-invalid":l.email}]),id:"ContactMail","aria-describedby":"emailHelp",placeholder:"請填寫電子信箱",name:"email",rules:"email|required",modelValue:a.orderData.data.user.email,"onUpdate:modelValue":s[0]||(s[0]=t=>a.orderData.data.user.email=t)},null,8,["class","modelValue"]),n(p,{name:"email",class:"invalid-feedback"})]),ne,e("div",ie,[re,n(u,{type:"text",class:h(["form-control",{"is-invalid":l.姓名}]),id:"ContactName",placeholder:"請填寫收件人姓名",name:"姓名",rules:"required",modelValue:a.orderData.data.user.name,"onUpdate:modelValue":s[1]||(s[1]=t=>a.orderData.data.user.name=t)},null,8,["class","modelValue"]),n(p,{name:"姓名",class:"invalid-feedback"})]),e("div",de,[ce,n(u,{type:"tel",class:h(["form-control",{"is-invalid":l.電話}]),id:"ContactPhone",placeholder:"請填寫手機號碼共十碼",name:"電話",rules:c.isPhone,modelValue:a.orderData.data.user.tel,"onUpdate:modelValue":s[2]||(s[2]=t=>a.orderData.data.user.tel=t)},null,8,["class","rules","modelValue"]),n(p,{name:"電話",class:"invalid-feedback"})]),e("div",me,[ue,n(u,{id:"address",name:"地址",type:"text",class:h(["form-control",{"is-invalid":l.地址}]),placeholder:"請輸入收件地址",rules:"required",modelValue:a.orderData.data.user.address,"onUpdate:modelValue":s[3]||(s[3]=t=>a.orderData.data.user.address=t)},null,8,["class","modelValue"]),n(p,{name:"地址",class:"invalid-feedback"})]),e("div",pe,[be,N(e("textarea",{class:"form-control",rows:"3",id:"ContactMessage",placeholder:"歡迎留下任何訊息","onUpdate:modelValue":s[4]||(s[4]=t=>a.orderData.data.message=t)},null,512),[[P,a.orderData.data.message]])]),e("div",_e,[n(V,{to:"products",class:"text-dark mt-md-0 mt-3"},{default:w(()=>[fe,m(" 回到產品頁")]),_:1}),e("button",{type:"button",class:"btn btn-primary py-3 px-7",onClick:s[5]||(s[5]=t=>c.postOrder()),disabled:Object.keys(l).length>0||Object.values(a.orderData.data.user).some(t=>t=="")},r(Object.keys(l).length==0&&!Object.values(a.orderData.data.user).some(t=>t=="")?"完成訂單":"請填入所有資料"),9,he)])]),_:1})])])])}const ye=k(L,[["render",ve]]);export{ye as default};
