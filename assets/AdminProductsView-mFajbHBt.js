import{_ as L,k as i,o as p,c as l,b as d,F as g,g as f,t as y}from"./index-TDYzlyc-.js";var P={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"popovgo",VITE_POKEMON_API:"https://pokeapi.co/api/v2",BASE_URL:"/PokemonMachineShop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:c,VITE_PATH:h,VITE_POKEMON_API:m}=P,k={data(){return{summarizedProductList:[],productList:[],products:[],machines:[],machineList:[],moveUrlList:[],moveList:[],typeUrlList:[],typeList:[],typeNameList:{},pokemons:{},speciesUrlList:[],speciesList:[],speciesNameList:{},pokemonCount:1025}},mounted(){this.login(),this.summarizeProductList()},methods:{async summarizeProductList(){await this.getMachines(),await this.getMachineList(),this.createSummarizedProductList(),await this.getMoveUrlList(),await this.getMoveList(),this.addMoveItemsFirst(),this.addMoveName(),this.addMoveText(),this.addMachineName(),this.addCost(),this.addId(),this.addMachinePhoto(),await this.createTypeUrlList(),await this.getTypeList(),this.getTypeNamesList(),await this.createSpeciesUrlList(),await this.getSpeciesList(),this.getSpeciesNamesList(),await this.getPokemons(),this.addMoveType(),this.addLearnedByPokemon(),this.updateLearnedByPokemon(),this.updatePokemonNames(),this.createProductList(),console.log("summarizedProductList",this.summarizedProductList),console.log("productList",this.productList)},async getMachines(){try{const s=await i.get(`${m}/item-category/37`);this.machines=s.data.items||[]}catch(s){console.dir(s)}},async getMachineList(){try{await Promise.all(this.machines.map(async(s,e)=>{const t=await i.get(s.url);t.data.flavor_text_entries.length&&this.machineList.push(t.data)})),this.machineList=this.machineList.sort(function(s,e){return s.id<e.id?-1:1})}catch(s){console.dir(s)}},async getMoveUrlList(){try{await Promise.all(this.machineList.map(async(s,e)=>{const t=await i.get(s.machines[0].machine.url);t.data&&this.moveUrlList.push(t.data)}))}catch(s){console.dir(s)}},async getMoveList(){try{await Promise.all(this.moveUrlList.map(async(s,e)=>{const t=await i.get(s.move.url);t.data&&this.moveList.push(t.data)})),this.moveList=this.moveList.sort(function(s,e){return s.machines[0].machine.url<e.machines[0].machine.url?-1:1}),console.log("this.moveList",this.moveList)}catch(s){console.dir(s)}},async createTypeUrlList(){try{(await i.get(`${m}/type`)).data.results.forEach((e,t)=>{this.typeUrlList.push({url:e.url}),this.typeUrlList[t].name=e.name})}catch(s){console.dir(s)}},async getTypeList(){try{await Promise.all(this.typeUrlList.map(async(s,e)=>{const t=await i.get(s.url);t.data&&this.typeList.push(t.data)}))}catch(s){console.dir(s)}},getTypeNamesList(){const s=[];this.typeList.forEach(a=>{s.push(a.names)});const e=[];s.forEach(a=>{e.push(a.filter(o=>o.language.name==="zh-Hant")[0].name||a[0].name)});const t=[];s.forEach(a=>{t.push(a.filter(o=>o.language.name==="en")[0].name||a[0].name)}),t.forEach((a,o)=>{this.typeNameList[a.toLowerCase()]=e[o]})},createSummarizedProductList(){this.machineList.forEach(s=>{this.summarizedProductList.push({})})},addMoveItemsFirst(){this.moveList.forEach((s,e)=>{const{accuracy:t,power:a,pp:o,damage_class:r}=s;this.summarizedProductList[e]={accuracy:t,power:a,pp:o,damage_class:r}})},addMoveText(){const s=[];this.moveList.forEach((t,a)=>{s.push(t.flavor_text_entries)});const e=[];s.forEach(t=>{e.push(t.filter(a=>a.language.name==="zh-Hant")[0]||t[0])}),e.forEach((t,a)=>{this.summarizedProductList[a].text=t.flavor_text})},addMoveName(){const s=[];this.moveList.forEach(t=>{s.push(t.names)});const e=[];s.forEach(t=>{e.push(t.filter(a=>a.language.name==="zh-Hant")[0]||t[0])}),e.forEach((t,a)=>{this.summarizedProductList[a].move_name=t.name})},addMoveType(){this.moveList.forEach((s,e)=>{this.summarizedProductList[e].type=this.typeNameList[s.type.name.toLowerCase()]})},addLearnedByPokemon(){this.moveList.forEach((s,e)=>{this.summarizedProductList[e].learned_by_pokemon=s.learned_by_pokemon})},stringifyLearnedByPokemon(s){const e=[];return s.forEach(t=>{e.push(JSON.stringify(t))}),e},addMachineName(){const s=[];this.machineList.forEach(t=>{s.push(t.names)});const e=[];s.forEach(t=>{e.push(t.filter(a=>a.language.name==="zh-Hant")[0]||t[0])}),e.forEach((t,a)=>{this.summarizedProductList[a].machine_name=t.name})},addCost(){this.machineList.forEach((s,e)=>{this.summarizedProductList[e].cost=s.cost})},addId(){this.machineList.forEach((s,e)=>{this.summarizedProductList[e].id=s.name})},addMachinePhoto(){this.moveList.forEach((s,e)=>{this.summarizedProductList[e].photo=`https://raw.githubusercontent.com/PokeAPI/sprites/master/sprites/items/tm-${s.type.name}.png`})},async getAllProducts(){const s=await i.get(`${c}/api/${h}/products`);this.products=s.data.products,console.log("this.products",this.products)},async deleteAllProducts(){await this.getAllProducts();const s=[];for(let t=0;t<this.products.length;t++)s.push(i.delete(`${c}/api/${h}/admin/product/${this.products[t].id}`));const e=await Promise.all(s);this.deleteAllProducts(),console.log(e)},forEachpostProducts(s){console.log("forEachpostProducts"),s.forEach((e,t)=>{t<100&&setTimeout(()=>{console.log(t),i.post(`${c}/api/${h}/admin/product`,{data:e})},5e3*t)})},async postProducts(s,e=!1){if(e===!1){const t=[];for(let o=s.length-1;o<s.length;o++)t.push(i.post(`${c}/api/${h}/admin/product`,{data:s[o]}));const a=await Promise.all(t);console.log(a)}else{const t=[];for(let o=e;o<=e;o++)t.push(i.post(`${c}/api/${h}/admin/product`,{data:s[o]}));const a=await Promise.all(t);console.log(a)}},createProductList(){this.summarizedProductList.forEach(s=>{this.productList.push({origin_price:s.cost||9999,content:s.id,pokemons:s.learned_by_pokemon,imagesUrl:this.stringifyLearnedByPokemon(s.learned_by_pokemon),title:s.machine_name,category:s.type,imageUrl:s.photo,description:s.text,unit:s.move_name,price:s.cost*.8||9999,is_enabled:1,accuracy:s.accuracy,power:s.power,pp:s.pp,damage_class:s.damage_class.name})})},updateLearnedByPokemon(){this.summarizedProductList.forEach(s=>{s.learned_by_pokemon.forEach(e=>{var t,a,o,r,n;e.speciesUrl=(a=(t=this.pokemons[e.name])==null?void 0:t.species)==null?void 0:a.url,e.imageUrl=(r=(o=this.pokemons[e.name])==null?void 0:o.sprites)==null?void 0:r.front_default,e.id=(n=this.pokemons[e.name])==null?void 0:n.id})})},async getPokemons(){const s=[];for(let t=1;t<=this.pokemonCount;t++)s.push(i.get(`${m}/pokemon/${t}`));(await Promise.all(s)).forEach(t=>{this.pokemons[t.data.name]=t.data,this.pokemons[t.data.name].chineseName=this.speciesNameList[t.data.name]}),console.log("this.pokemons",this.pokemons)},async createSpeciesUrlList(){try{(await i.get(`${m}/pokemon-species?offset=0&limit=${this.pokemonCount}`)).data.results.forEach((e,t)=>{this.speciesUrlList.push({url:e.url}),this.speciesUrlList[t].name=e.name})}catch(s){console.dir(s)}},async getSpeciesList(){try{await Promise.all(this.speciesUrlList.map(async(s,e)=>{const t=await i.get(s.url);t.data&&this.speciesList.push(t.data)}))}catch(s){console.dir(s)}},getSpeciesNamesList(){const s=[];this.speciesList.forEach(a=>{s.push(a.names)});const e=[];s.forEach(a=>{e.push(a.filter(o=>o.language.name==="zh-Hant")[0].name||a[0].name)});const t=[];s.forEach(a=>{t.push(a.filter(o=>o.language.name==="en")[0].name||a[0].name)}),t.forEach((a,o)=>{this.speciesNameList[a.toLowerCase()]=e[o]})},updatePokemonNames(){this.summarizedProductList.forEach(s=>{s.learned_by_pokemon.forEach(e=>{e.name=this.speciesNameList[e.name]})})},async login(){try{const s=await i.post(`${c}/admin/signin`,{username:"hungminliu@gmail.com",password:"gopopov"}),{token:e,expired:t}=s.data;document.cookie.replace(/(?:(?:^|.*;\s*)loginToken\s*=\s*([^;]*).*$)|^.*$/,"$1")!=="true"&&(document.cookie=`loginToken=${e}; expires=${new Date(t)}; path=/`);const a=document.cookie.replace(/(?:(?:^|.*;\s*)loginToken\s*=\s*([^;]*).*$)|^.*$/,"$1");i.defaults.headers.common.Authorization=a,console.log(s)}catch(s){console.dir(s)}}}},E={class:"row"},v=["onClick"];function _(s,e,t,a,o,r){return p(),l("div",null,[d("button",{class:"btn btn-danger",onClick:e[0]||(e[0]=n=>r.deleteAllProducts())},"deleteAllProducts"),d("button",{class:"btn btn-primary",onClick:e[1]||(e[1]=n=>r.postProducts(o.productList))},"postAllProducts"),d("button",{class:"btn btn-primary",onClick:e[2]||(e[2]=n=>r.forEachpostProducts(o.productList))},"forEachpostProducts"),d("div",E,[(p(!0),l(g,null,f(o.productList,(n,u)=>(p(),l("button",{key:n.id,class:"btn btn-primary col-2",onClick:w=>r.postProducts(o.productList,u)},y(u)+" postProducts",9,v))),128))])])}const $=L(k,[["render",_]]);export{$ as default};
