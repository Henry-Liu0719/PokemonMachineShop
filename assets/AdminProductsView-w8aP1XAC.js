import{a as o}from"./axios-G2rPRu76.js";import{_ as p,o as l,c as u,b as L}from"./index-q4GorJFx.js";var f={VITE_URL:"https://vue3-course-api.hexschool.io/v2",VITE_PATH:"gopopov",VITE_POKEMON_API:"https://pokeapi.co/api/v2",BASE_URL:"/PokemonMachineShop/",MODE:"production",DEV:!1,PROD:!0,SSR:!1};const{VITE_URL:n,VITE_PATH:c,VITE_POKEMON_API:h}=f,g={data(){return{summarizedProductList:[],productList:[],products:[],machines:[],machineList:[],moveUrlList:[],moveList:[],typeUrlList:[],typeList:[],typeNameList:{},pokemons:{},speciesUrlList:[],speciesList:[],speciesNameList:{}}},mounted(){this.summarizeProductList()},methods:{async summarizeProductList(){await this.getPokemons(),await this.getMachines(),await this.getMachineList(),this.createSummarizedProductList(),this.addMachineName(),this.addCost(),this.addId(),this.addMachinePhoto(),await this.getMoveUrlList(),await this.getMoveList(),this.addMoveName(),this.addMoveText(),await this.createTypeUrlList(),await this.getTypeList(),this.getTypeNamesList(),this.addMoveType(),this.addLearnedByPokemon(),this.updateLearnedByPokemon(),await this.createSpeciesUrlList(),await this.getSpeciesList(),this.getSpeciesNamesList(),this.updatePokemonNames(),this.createProductList(),console.log("summarizedProductList",this.summarizedProductList),console.log("productList",this.productList)},async getMachines(){try{const e=await o.get(`${h}/item-category/37`);this.machines=e.data.items||[]}catch(e){console.dir(e)}},async getMachineList(){try{await Promise.all(this.machines.map(async(e,s)=>{const t=await o.get(e.url);t.data.flavor_text_entries.length&&this.machineList.push(t.data)})),this.machineList=this.machineList.sort(function(e,s){return e.id<s.id?-1:1})}catch(e){console.dir(e)}},async getMoveUrlList(){try{await Promise.all(this.machineList.map(async(e,s)=>{const t=await o.get(e.machines[0].machine.url);t.data&&this.moveUrlList.push(t.data)}))}catch(e){console.dir(e)}},async getMoveList(){try{await Promise.all(this.moveUrlList.map(async(e,s)=>{const t=await o.get(e.move.url);t.data&&this.moveList.push(t.data)})),this.moveList=this.moveList.sort(function(e,s){return e.machines[0].machine.url<s.machines[0].machine.url?-1:1})}catch(e){console.dir(e)}},async createTypeUrlList(){try{(await o.get(`${h}/type`)).data.results.forEach((s,t)=>{this.typeUrlList.push({url:s.url}),this.typeUrlList[t].name=s.name})}catch(e){console.dir(e)}},async getTypeList(){try{await Promise.all(this.typeUrlList.map(async(e,s)=>{const t=await o.get(e.url);t.data&&this.typeList.push(t.data)}))}catch(e){console.dir(e)}},getTypeNamesList(){const e=[];this.typeList.forEach(a=>{e.push(a.names)});const s=[];e.forEach(a=>{s.push(a.filter(i=>i.language.name==="zh-Hant")[0].name||a[0].name)});const t=[];e.forEach(a=>{t.push(a.filter(i=>i.language.name==="en")[0].name||a[0].name)}),t.forEach((a,i)=>{this.typeNameList[a.toLowerCase()]=s[i]})},createSummarizedProductList(){this.machineList.forEach(e=>{this.summarizedProductList.push({})})},addMoveText(){const e=[];this.moveList.forEach(t=>{e.push(t.flavor_text_entries)});const s=[];e.forEach(t=>{s.push(t.filter(a=>a.language.name==="zh-Hant")[0]||t[0])}),s.forEach((t,a)=>{this.summarizedProductList[a].text=t.flavor_text})},addMoveName(){const e=[];this.moveList.forEach(t=>{e.push(t.names)});const s=[];e.forEach(t=>{s.push(t.filter(a=>a.language.name==="zh-Hant")[0]||t[0])}),s.forEach((t,a)=>{this.summarizedProductList[a].move_name=t.name})},addMoveType(){this.moveList.forEach((e,s)=>{this.summarizedProductList[s].type=this.typeNameList[e.type.name.toLowerCase()]})},addLearnedByPokemon(){this.moveList.forEach((e,s)=>{this.summarizedProductList[s].learned_by_pokemon=e.learned_by_pokemon})},stringifyLearnedByPokemon(e){const s=[];return e.forEach(t=>{s.push(JSON.stringify(t))}),s},addMachineName(){const e=[];this.machineList.forEach(t=>{e.push(t.names)});const s=[];e.forEach(t=>{s.push(t.filter(a=>a.language.name==="zh-Hant")[0]||t[0])}),s.forEach((t,a)=>{this.summarizedProductList[a].machine_name=t.name})},addCost(){this.machineList.forEach((e,s)=>{this.summarizedProductList[s].cost=e.cost})},addId(){this.machineList.forEach((e,s)=>{this.summarizedProductList[s].id=e.name})},addMachinePhoto(){this.machineList.forEach((e,s)=>{this.summarizedProductList[s].photo=e.sprites.default})},getAllProducts(){o.get(`${n}/api/${c}/products/all`).then(e=>{}).catch(e=>{console.dir(e)})},deleteAllProducts(){o.get(`${n}/api/${c}/products/all`).then(t=>{console.log(t);const a=[];t.data.products.forEach(i=>{a.push(i.id)}),e(a)}).catch(t=>{console.dir(t)});function e(t){o.post(`${n}/admin/signin`,{username:"hungminliu@gmail.com",password:"gopopov"}).then(a=>{const{token:i,expired:r}=a.data;document.cookie.replace(/(?:(?:^|.*;\s*)loginToken\s*=\s*([^;]*).*$)|^.*$/,"$1")!=="true"&&(document.cookie=`loginToken=${i}; expires=${new Date(r)}; path=/`);const m=document.cookie.replace(/(?:(?:^|.*;\s*)loginToken\s*=\s*([^;]*).*$)|^.*$/,"$1");o.defaults.headers.common.Authorization=m,console.log(a),t.forEach(d=>{s(d)})}).catch(a=>{alert(a.response.data.error.message)})}function s(t){o.delete(`${n}/api/${c}/admin/product/${t}`).then(a=>{console.log(a)}).catch(a=>{console.dir(a)})}},createProductList(){this.summarizedProductList.forEach(e=>{this.productList.push({origin_price:e.cost||9999,content:e.id,pokemons:e.learned_by_pokemon,imagesUrl:this.stringifyLearnedByPokemon(e.learned_by_pokemon),title:e.machine_name,category:e.type,imageUrl:e.photo,description:e.text,unit:e.move_name,price:e.cost*.8||9999,is_enabled:1})})},updateLearnedByPokemon(){this.summarizedProductList.forEach(e=>{e.learned_by_pokemon.forEach(s=>{var t,a,i,r;s.url=(a=(t=this.pokemons[s.name])==null?void 0:t.species)==null?void 0:a.url,s.imageUrl=(r=(i=this.pokemons[s.name])==null?void 0:i.sprites)==null?void 0:r.front_default})})},async getPokemons(){const e=[];for(let t=1;t<=1e3;t++)e.push(o.get(`https://pokeapi.co/api/v2/pokemon/${t}`));(await Promise.all(e)).forEach(t=>{this.pokemons[t.data.name]=t.data})},async createSpeciesUrlList(){try{(await o.get(`${h}/pokemon-species?offset=0&limit=1000`)).data.results.forEach((s,t)=>{this.speciesUrlList.push({url:s.url}),this.speciesUrlList[t].name=s.name})}catch(e){console.dir(e)}},async getSpeciesList(){try{await Promise.all(this.speciesUrlList.map(async(e,s)=>{const t=await o.get(e.url);t.data&&this.speciesList.push(t.data)}))}catch(e){console.dir(e)}},getSpeciesNamesList(){const e=[];this.speciesList.forEach(a=>{e.push(a.names)});const s=[];e.forEach(a=>{s.push(a.filter(i=>i.language.name==="zh-Hant")[0].name||a[0].name)});const t=[];e.forEach(a=>{t.push(a.filter(i=>i.language.name==="en")[0].name||a[0].name)}),t.forEach((a,i)=>{this.speciesNameList[a.toLowerCase()]=s[i]})},updatePokemonNames(){this.summarizedProductList.forEach(e=>{e.learned_by_pokemon.forEach(s=>{s.name=this.speciesNameList[s.name]})})}}};function y(e,s,t,a,i,r){return l(),u("div",null,[L("button",{class:"btn btn-danger",onClick:s[0]||(s[0]=m=>r.deleteAllProducts())},"deleteAllProducts")])}const _=p(g,[["render",y]]);export{_ as default};
